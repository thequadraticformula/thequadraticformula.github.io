<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genie's Tic-Tac-Toe</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Style for the game cells */
        .game-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem; /* Large X and O */
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            aspect-ratio: 1 / 1; /* Keep cells square */
        }

        /* Don't allow hover effect on already-filled cells */
        .game-cell:not(.filled):hover {
            background-color: #4b5563; /* gray-600 */
        }
        
        .game-cell.filled {
            cursor: not-allowed;
        }

        /* Player X color */
        .text-player-x {
            color: #a5b4fc; /* indigo-300 */
        }

        /* Player O (Genie) color */
        .text-player-o {
            color: #ffffff; /* white */
        }
        
        /* Winning cell highlight */
        .win-cell {
            background-color: #4f46e5 !important; /* indigo-600 */
            color: #ffffff !important;
        }

        .home-link {
            margin-top: 24px;
            font-size: 1.1rem;
            color: #a5b4fc; /* Lighter indigo */
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .home-link:hover {
            color: #c7d2fe; /* Even lighter */
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-full flex flex-col items-center justify-center p-4">

    <!-- Main App Container -->
    <div class="bg-gray-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden border border-indigo-500/30 p-6 sm:p-8">
        
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-center text-indigo-300">
                ðŸ§ž Genie's Tic-Tac-Toe ðŸ§ž
            </h1>
        </header>
        
        <!-- Game Board -->
        <main id="game-board" class="grid grid-cols-3 gap-3 mb-6">
            <!-- Cells will be generated by JS -->
            <!-- <div class="game-cell bg-gray-700 rounded-lg border border-indigo-500/50"></div> -->
        </main>
        
        <!-- Game Status -->
        <div id="status-display" class="text-center text-indigo-200 text-xl h-8 mb-6">
            Your turn (X)
        </div>

        <!-- Reset Button -->
        <button 
            id="reset-button"
            class="w-full bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 focus:ring-offset-gray-900 transition duration-200"
        >
            Reset Game
        </button>
    </div>

    <a href="https://geniewishgame.github.io" class="home-link">
        &larr; Return to the main page
    </a>

    <script>
        // --- DOM Elements ---
        const gameBoard = document.getElementById('game-board');
        const statusDisplay = document.getElementById('status-display');
        const resetButton = document.getElementById('reset-button');

        // --- Game State ---
        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let isGameActive = true;

        const PLAYER_X = 'X';
        const PLAYER_O = 'O';

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
            [0, 4, 8], [2, 4, 6]  // Diagonals
        ];
        
        // --- Cell Elements Array ---
        let cells = [];

        /**
         * Initializes the game, clears the board, and sets up cells.
         */
        function initializeGame() {
            board = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = PLAYER_X;
            isGameActive = true;
            statusDisplay.textContent = "Your turn (X)";
            gameBoard.innerHTML = '';
            cells = [];

            // Create 9 game cells
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('game-cell', 'bg-gray-700', 'rounded-lg', 'border', 'border-indigo-500/50');
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                gameBoard.appendChild(cell);
                cells.push(cell);
            }
        }

        /**
         * Handles clicking on a game cell.
         * @param {Event} e - The click event.
         */
        function handleCellClick(e) {
            const clickedCell = e.target;
            const index = parseInt(clickedCell.dataset.index);

            // Check if cell is already filled or game is inactive
            if (board[index] !== '' || !isGameActive || currentPlayer === PLAYER_O) {
                return;
            }

            // Player's move
            updateBoard(index, PLAYER_X);

            if (checkResult()) {
                return; // Game over
            }
            
            // Switch to Genie's turn
            currentPlayer = PLAYER_O;
            statusDisplay.textContent = "Genie is thinking... (O)";
            
            // Add a small delay for the Genie's "thinking"
            setTimeout(genieTurn, 700);
        }

        /**
         * Updates the board state and UI for a move.
         * @param {number} index - The cell index (0-8).
         * @param {string} player - PLAYER_X or PLAYER_O.
         */
        function updateBoard(index, player) {
            board[index] = player;
            cells[index].textContent = player;
            cells[index].classList.add('filled', player === PLAYER_X ? 'text-player-x' : 'text-player-o');
        }

        /**
         * Checks the game board for a win or a draw.
         * @returns {boolean} - True if the game is over (win or draw), false otherwise.
         */
        function checkResult() {
            let roundWon = false;
            let winningLine = [];

            for (let i = 0; i < winningConditions.length; i++) {
                const winCondition = winningConditions[i];
                let a = board[winCondition[0]];
                let b = board[winCondition[1]];
                let c = board[winCondition[2]];

                if (a === '' || b === '' || c === '') {
                    continue; // Skip empty cells
                }
                if (a === b && b === c) {
                    roundWon = true;
                    winningLine = winCondition;
                    break;
                }
            }

            if (roundWon) {
                endGame(false, winningLine);
                return true;
            }

            // Check for draw
            if (!board.includes('')) {
                endGame(true);
                return true;
            }

            return false;
        }

        /**
         * Ends the game, displays the result, and highlights winning cells.
         * @param {boolean} isDraw - True if the game is a draw.
         * @param {number[]} winningLine - Array of indices for the winning line.
         */
        function endGame(isDraw, winningLine = []) {
            isGameActive = false;
            
            if (isDraw) {
                statusDisplay.textContent = "It's a draw! How boring.";
            } else {
                const winner = board[winningLine[0]];
                statusDisplay.textContent = winner === PLAYER_X ? 'You win! Impossible!' : 'I win! As expected.';
                
                // Highlight winning cells
                winningLine.forEach(index => {
                    cells[index].classList.add('win-cell');
                });
            }
        }

        /**
         * Simulates the Genie's (AI) turn.
         */
        function genieTurn() {
            if (!isGameActive) return;

            const bestMove = findBestMove();
            
            updateBoard(bestMove, PLAYER_O);

            if (checkResult()) {
                return; // Game over
            }

            // Switch back to Player's turn
            currentPlayer = PLAYER_X;
            statusDisplay.textContent = "Your turn (X)";
        }

        /**
         * Finds the best move for the Genie (AI).
         * Logic:
         * 1. Check if Genie can win in one move.
         * 2. Check if Player can win in one move (and block).
         * 3. Take the center if available.
         * 4. Take a corner if available.
         * 5. Take any available side.
         * @returns {number} - The index of the best move.
         */
        function findBestMove() {
            // 1. Check for Genie's winning move
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    board[i] = PLAYER_O; // Try move
                    if (isWinningMove(PLAYER_O)) {
                        board[i] = ''; // Reset
                        return i;
                    }
                    board[i] = ''; // Reset
                }
            }

            // 2. Check for Player's winning move to block
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    board[i] = PLAYER_X; // Try move
                    if (isWinningMove(PLAYER_X)) {
                        board[i] = ''; // Reset
                        return i;
                    }
                    board[i] = ''; // Reset
                }
            }

            // 3. Take center if available
            if (board[4] === '') {
                return 4;
            }

            // 4. Take a random corner
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(i => board[i] === '');
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }

            // 5. Take a random side
            const sides = [1, 3, 5, 7];
            const availableSides = sides.filter(i => board[i] === '');
            if (availableSides.length > 0) {
                return availableSides[Math.floor(Math.random() * availableSides.length)];
            }
            
            // 6. (Fallback) Just find the first available cell
            // This should rarely be needed with the logic above
            return board.indexOf('');
        }

        /**
         * Helper function to check if a player has a winning move
         * (Assumes the move has already been temporarily placed on the board).
         * @param {string} player - The player (X or O) to check for.
         * @returns {boolean} - True if the player has won.
         */
        function isWinningMove(player) {
            for (const condition of winningConditions) {
                if (board[condition[0]] === player &&
                    board[condition[1]] === player &&
                    board[condition[2]] === player) {
                    return true;
                }
            }
            return false;
        }

        // --- Event Listeners ---
        resetButton.addEventListener('click', initializeGame);

        // --- Initial Render ---
        initializeGame();

    </script>
</body>
</html>
